{% extends 'main/base.html' %}
{% block main %}
{% include 'main/includes/navbar.html' %}
{% include 'main/includes/left-sidebar.html' with option="salesman" %}
<div class="main">
      <div class="main-content">
        <div class="container-fluid">
                 
                 {% include 'main/includes/tableView.html' with  heading="SalesMan" %}
                 {% include 'main/includes/chart.html'     with  id="percentile-salesman" heading="Salesman Percentile" %}
                 {% include 'main/includes/compare.html'     with  id="comparison-salesman" heading="Compare Two Salesmen" %}
                 
                  
          </div>

      </div>
</div>

{% endblock main%}

{% block stat %}
<script type="text/javascript">
      $(function() {
            LoadDefault("SalesMan","volume", 1);
            LoadDefault("SalesMan","tk", 1);
            LoadPercentlie("salesman");
      });

      $("#chooser > form").submit(function(event){
          console.log(1);
            event.preventDefault();
            var beginDate = document.getElementById(this.id + "-beginDate").value;
            var endDate = document.getElementById(this.id + "-endDate").value;
            var e = document.getElementById(this.id + "-product");
            var product = '', client = '', region= '', salesman = '';

            if(e!= null) product = e.options[e.selectedIndex].value;

            e = document.getElementById(this.id + "-client");
            if(e != null) client = e.options[e.selectedIndex].value;

            e = document.getElementById(this.id + "-region");
            if(e != null) region = e.options[e.selectedIndex].value;

            e = document.getElementById(this.id + "-salesman");
            if(e != null) salesman =e.options[e.selectedIndex].value;

            var info = this.id.split('-');
            LoadTable(info[0], info[1], 1 , beginDate, endDate,product,client,region,salesman);
      });
      $('.paging').on('click', 'a', function(e){
        
        e.preventDefault(); 
      
        var info = $(this).attr('href').split('-');
        var id  = info[0] + "-" + info[1] + '-choose';
        
        console.log(id);
        var beginDate = document.getElementById(id + "-beginDate").value;
        var endDate = document.getElementById(id + "-endDate").value;
        var e = document.getElementById(id + "-product");
        var product = '', client = '', region= '', salesman = '';

        var flag = 0;

        if(e!= null) product = e.options[e.selectedIndex].value;

        e = document.getElementById(id + "-client");
        if(e != null) client = e.options[e.selectedIndex].value;

        e = document.getElementById(id + "-region");
        if(e != null) region = e.options[e.selectedIndex].value;

        e = document.getElementById(id + "-salesman");
        if(e != null) salesman =e.options[e.selectedIndex].value;

        if(beginDate == '' && endDate == '' && 
          product == '' && client == '' &&
          region =='' && salesman == '') {
          console.log(info[0]);
          LoadDefault(info[0], info[1], info[2]);
        }
        else LoadTable(info[0], info[1], info[2], beginDate, endDate,product,client,region,salesman);
      }); 
      function Comparison(p1,p2,queryType) {
            $.ajax({
                  method      :"GET",
                  url         :'/api/compare/' ,
                  data        : {
                      'modelName': 'SalesMan',
                      'p1' : p1,
                      'p2' : p2,
                      'queryType': queryType,
                  },
                  success: function(data){
                      drawChart(document.getElementById('comparison-salesman-chart'),'line', data, "First","Second"); 

                  } ,
            });
      }

      $("#comparison-salesman").submit(function(event){
          console.log(1);
            event.preventDefault();
            var p1 = 0, p2 = 0;
            var id = "comparison-salesman";
            var e1 = document.getElementById(id + "-s1");
            if (e1 != null) p1 = e1.options[e1.selectedIndex].value;
            var e2 = document.getElementById(id + "-s2");
            if(e2 != null) p2  = e2.options[e2.selectedIndex].value;
            var Value = $('input[name=radio]:checked').val(); 
            if(p1 > 0 && p2 > 0 && (Value != null && Value != '') ) {
              $('#comparison-salesman-chart').show();
                Comparison(p1,p2,Value);
            }
            else{
              console.log(102);
              $('#comparison-salesman-chart').hide();
            }
                

        });

      

</script>
{% endblock %}
